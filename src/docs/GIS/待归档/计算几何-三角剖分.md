---
title: 计算几何-三角剖分
article: false
category:
  - 待归档
  - 计算几何
  - 三角剖分
---
## 三角剖分
- 将多边形分解为若干个三角形
- 对角线：连接多边形任何两个顶点之间的一条线
  - 不合法的对角线：不能穿过多边形的边界
  - 合法的称为内对角线，且内对角线之间不能冲突
- 三角剖分triangulation
  - 对多边形进行三角剖分
  - 对点集进行三角网格生成(例如对点云进行处理)
### 点集三角剖分
- 对点集进行预处理
  - 将他们彼此进行连接，构成一张网络(mesh，网格)
### 多边形三角剖分
- 规则多边形(正...)、凸包、星型多边形(扇形多边形也是其中一种)
- 正交多边形：每一条边不是垂直的就是水平的

- 定理：任何多边形都可以分解成若干个扇形，且扇形的数目不超过n/3
#### 三角剖分的存在性
- 存在性的研究对象：简单多边形、简单有洞多边形
  - 简单多边形(Simple Polygon)一定存在三角剖分
    - 简单多边形：非相邻的边不会相交
      - 非简单多边形：漏斗型等
  - 有洞多边形
    - 有一个最大的边界：outer boundary
    - 有若干个内边界：inner boundary
    - 定义：ob是逆时针的，ib是顺时针的
- 存在性用数学归纳法证明
  - 证明的前提：每个多边形都要进行排序，是一种分类，
    - 两个简单多边形判断大小：
      - 先比较谁的洞更多，洞越多，该多边形越"大"
        - 若洞数相同，则比较顶点数目
      - 有可能相等

此后，，所有的简单多边形都简写为多边形
#### 三角剖分的性质
1. 同一个多边形三角剖分的方案并不唯一
2. 任何一个不带洞的多边形，在经过三角剖分之后，该三角剖分的对偶图必然是一棵树
3. 任何一个带洞的多边形，在经过三角剖分之后，该三角剖分的对偶图必然是一个有闭合回路的图。且环路数等于洞数
#### 不含洞的多边形实现O(n)
1. 先将多边形剖分成若干个单调多变行
   - 单调：相对于某个特定的方向的直线而言，将多边形链所有的顶点都投影到这条直线后，所有原来在链上的顶点的相对次序，在这条直线上依旧保持。则称这条多边形链相对于这条直线是单调的。
     - 若某条链沿着某个方向是单调的，笼统的称为该链是单调的(monotone)
     - d多边形的单调性建立在多边形链单调性的基础上
     - 若某个多边形是单调的，则他可以分解成互补的两条链，且这两条链都是沿着相同方向单调的，一般将这个方向取为y轴，这两条链称为左链和右链。这两条链在最低、最高处缝合，形成多边形
   - 本质就是消除向内部的凹陷点
     - 凹陷点的情况 、
       - 多边形的内部在其下方，与该点相邻的两个点都在其上方，这种点称为钟乳石T
       - 多边形的内部在其上方，与该点相邻的两个点都在其下方，这种点称为下方M
   - 对多边形的单调剖分其实就是消除掉凹陷点
     - 此处以消除M为例
       - 把所有顶点按照高度排序
       - 然后扫描线法，若发现了M，将之前存储好的某个顶点和M形成内对角线
         - 如何储备、维护将来任何一个潜在M要用到的哪个结点,这个结点称为helper
           - 必然存在以M为支撑点的一个假想梯形，梯形上方由helper支撑，该梯形完全落在多边形内部，且梯形是空的
             - helper的三种可能，这些可能的前提是他们之间的连线是一条安全的内对角线
               - helper是梯形左边界的上端点
               - helper是梯形右边界的上端点
               - helper恰好就是一个T
             - 扫描线的状态结构记录当前活跃的梯形
           - 如何对helper进行动态更新
             - 六类事件
               - 1. 有个顶点v是凹角，且其相邻的两个点都比其低，注意该顶点不是M，因为多边形在其下方，而不是上方。这种点称为start event。此时会出现一个退化的梯形：三角形，此时也要把这个梯形加到状态结构中，且为其指定一个helper：v
               - 2. end event,有个顶点v是凹角,且其相邻的两个点都比其高，。此时在整个状态结构中，找到这个梯形，并将其从结构中删除
               - 3. left adjacency，左侧相邻的情况，有个顶点v是凹角，且其相邻的两个点在其上方和下方，原来的梯形转化为新的梯形。将原先的梯形在整个状态结构中替换为新的梯形，新的梯形的helper不需要再沿用之前的梯形的helper了，因为其有了一个新的可用的heleper：v
               - 4. right adjacency，右侧相邻的情况，有个顶点v是凹角，且其相邻的两个点在其上方和下方，原来的梯形转化为新的梯形。将原先的梯形在整个状态结构中替换为新的梯形，新的梯形的helper不需要再沿用之前的梯形的helper了，因为其有了一个新的可用的heleper：v
               - 5. 扫描到m，要取出一个helper并连接m，该helper无非就是上述三种情况之一。重要的是原先大的梯形被分裂，被替换为左右两个梯形，且设置v为这两个梯形的helper
               - 5. 扫描到t，发现有两个梯形相邻。且这两个梯形在v处缝合，在状态结构中找到这两个梯形并替换为一个新的梯形，该梯形helper为v
   - 复杂度：nlogn，不是最优，最优的算法时nloglogn，理论上最优的是n而太复杂
     - 排序nlogn
     - 状态结构，查找、插入、删除logn，累计后nlogn
2. 对每一个单调多边形做细致的三角剖分
   - 扫描线策略
     - 从上而下扫描每个顶点(本次不考虑歧义点)
       - 对不同的事件点进行不同的操作
         - 对事件进行梳理和排序
           - 将多边形从上到下将所有顶点进行排序赋值，从0开始(一般的排序是nlogn)
             - 将两条有序链：左链的排序和右链的排序进行归并，而左链排序是O(n)，右链也是O(n)，所以归并也是O(n),不需要nlogn
       - 三种事件点
         - 扫描线正在扫描的新点current vertex，c
         - 在栈顶的结点top，t
         - 次栈顶s
       - 栈中的点和单调链之间的关系：
         - 1. 在栈中所存的点，在任何时候都属于左或右链
         - 2. 这些顶点不仅总是来自同一侧，且按照高度单调变化的
         - 3. 栈中所有的点，任何相邻的三个点的内角都是凹的，即大于180°
         - 4. 扫描线到达c时，有两种可能
           - c可能和t相连
           - c和栈底bottom相连
   - 对单调多边形剖分会遇到的情况
     - case A：
       - A1：c和栈中所有点同侧、cts是凹角reflex。此时将c压栈，继续扫描
       - A2：c和栈中所有点同侧，cts是凸角convex。此时连接cs，切耳，t弹出。若此时新的栈顶元素s和c和当前的次栈顶是convex，则继续切耳，弹出...直到cts是凹的，或栈中不足两个元素，则调出循环。最后把c压栈，此时栈中两个元素。在这个过程中，都满足四条关系
     - case B:
       - c和栈中所有点异侧(此时扫描线扫到右链上的点了)，且符合四条关系(注意4是c和栈底bottom相连)
         - 此时c和栈中点(除了bottom)相连，生成内对角线，每生成一条对角线，可以切耳一次(切cts)...直到只剩栈底，为了之后的工作，需要将bottom弹出、将原先的栈顶入栈、c出栈，此时扫描线才可以继续往下扫描
           - 被切耳的那些顶点没有用了，必须出栈
   - 复杂度：O(n)
     - 左右排序n,归并n
     - 每个顶点push最多两次，2n
     - pop不可能超过push的总数：两次，所以pop小于2n
     - 切耳操作：常数
     - 所以，累计复杂度为线性时间n

## earcut