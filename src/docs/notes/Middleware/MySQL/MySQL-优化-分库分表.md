---
title: MySQL-优化-分库分表
article: false
category:
  - 中间件
  - MySQL
---
## 分库分表
### 什么情况下需要分库分表
1. 项目业务数据逐渐增多，或业务发展比较迅速（单表的数据量达1000W或20G以后）
2. 优化已解决不了性能问题（主从读写分离、查询索引…）
3. IO瓶颈（磁盘IO、网络IO）、CPU瓶颈（聚合查询、连接数太多）
![分库分表的策略](https://blog-image-9943.oss-cn-beijing.aliyuncs.com/202308171706041.png)
## 分库
- 将原先的一个数据库拆分成多个数据库进行存储
  - 解决存储压力，每一个库都能处理用户的请求
![分库分表好处](https://blog-image-9943.oss-cn-beijing.aliyuncs.com/202308171705794.png)
### 垂直分库
- 以表为依据，根据业务将不同表拆分到不同库中。
- 特点：
  - 按业务对数据分级管理、维护、监控、扩展
  - 在高并发下，提高磁盘IO和数据量连接数
![垂直分库](https://blog-image-9943.oss-cn-beijing.aliyuncs.com/202308171709321.png)
### 水平分库
- 将一个库的数据拆分到多个库中
  - 订单量越来越大，一个库中存不下了且影响性能
- 特点
  - 解决了单库大数量，高并发的性能瓶颈问题
  - 提高了系统的稳定性和可用性
- 路由规则
  - 根据id节点取模
  - 按id也就是范围路由，节点1(1-100万),节点2(100万-200万)

![水平分库](https://blog-image-9943.oss-cn-beijing.aliyuncs.com/202308171715890.png)

## 分表
- 将原先的一个表拆分成多个表进行存储
### 垂直分表
- 以字段为依据，根据字段属性将不同字段拆分到不同表中。
- 特点
  - 冷热数据分离
  - 减少IO过渡争抢，两表互不影响
- 拆分规则
  - 把不常用的字段单独放在一张表
  - 把text，blob等大字段拆分出来放在附表中
![垂直分表](https://blog-image-9943.oss-cn-beijing.aliyuncs.com/202308171712667.png)
### 水平分表
- 将一个表的数据拆分到多个表中(可以在同一个库内)。
- 特点
  - 优化单一表数据量过大而产生的性能问题;
  - 避免IO争抢并减少锁表的几率;
![水平分表](https://blog-image-9943.oss-cn-beijing.aliyuncs.com/202308171717427.png)
## 分库分表后技术上的变化
![分库分表后技术上的变化](https://blog-image-9943.oss-cn-beijing.aliyuncs.com/202308171721803.png)
- 分库之后的问题：
  - 分布式事务一致性问题
  - 跨节点关联查询
  - 跨节点分页、排序函数
  - 主键避重
- 分库分表中间件：
  - sharding-sphere
  - mycat
- 分库分表的缺点
  - 破坏了一定的业务逻辑来换取性能
    - 如何解决：把频繁操作的数据放到nosql数据库中(例如redis)，做缓存，减少IO操作












